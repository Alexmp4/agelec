jQuery(document).ready(function(e){function s(){var e=wpslSettings.defaultLatLng.split(","),s=new google.maps.LatLng(e[0],e[1]),o={};o={zoom:parseInt(wpslSettings.defaultZoom),center:s,mapTypeId:google.maps.MapTypeId[wpslSettings.mapType.toUpperCase()],mapTypeControl:!1,streetViewControl:!1,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP}},O=new google.maps.Geocoder,L=new google.maps.Map(document.getElementById("wpsl-gmap-wrap"),o),t()}function t(){var s,t=e("#wpsl-lat").val(),o=e("#wpsl-lng").val();t&&o&&(s=new google.maps.LatLng(t,o),L.setCenter(s),L.setZoom(16),r(s))}function o(){var e,s=document.getElementById("wpsl-start-name"),t={types:["geocode"]},o=new google.maps.places.Autocomplete(s,t);google.maps.event.addListener(o,"place_changed",function(){e=o.getPlace().geometry.location,l(e,"zoom")})}function r(e){var s=new google.maps.Marker({position:e,map:L,draggable:!0});P.push(s),google.maps.event.addListener(s,"dragend",function(){l(s.getPosition(),"store")})}function l(s,t){var o=d(s),r=c(o[0]),l=c(o[1]);"store"==t?(e("#wpsl-lat").val(r),e("#wpsl-lng").val(l)):"zoom"==t&&e("#wpsl-latlng").val(r+","+l)}function n(){var s,t;return i()?(w("first"),alert(wpslL10n.missingGeoData),!0):(t=a(),O.geocode({address:t},function(t,o){o===google.maps.GeocoderStatus.OK?("undefined"!=typeof P[0]&&P[0].draggable&&(P[0].setMap(null),P.splice(0,1)),L.setCenter(t[0].geometry.location),L.setZoom(16),r(t[0].geometry.location),l(t[0].geometry.location,"store"),s=p(t),e("#wpsl-country").val(s.country.long_name),e("#wpsl-country_iso").val(s.country.short_name)):alert(wpslL10n.geocodeFail+": "+o)}),!1)}function i(){var s,t,o,r=!1;if(e(".wpsl-store-meta input").removeClass("wpsl-error"),"undefined"!=typeof wpslSettings.requiredFields&&_.isArray(wpslSettings.requiredFields))for(o=wpslSettings.requiredFields,s=0;s<o.length;s++)t=e.trim(e("#wpsl-"+o[s]).val()),t||(e("#wpsl-"+o[s]).addClass("wpsl-error"),r=!0),t="";return r}function a(){var s,t,o=[],r=["address","city","state","zip","country"];for(s=0;s<r.length;s++)t=e.trim(e("#wpsl-"+r[s]).val()),t&&o.push(t),t="";return o.join()}function p(e){var s,t,o={},r={},l=e[0].address_components.length;for(s=0;l>s;s++)t=e[0].address_components[s].types,/^country,political$/.test(t)&&(o={long_name:e[0].address_components[s].long_name,short_name:e[0].address_components[s].short_name});return r={country:o}}function c(e){var s,t=6;return s=Math.round(e*Math.pow(10,t))/Math.pow(10,t)}function d(e){var s=[],t=e.toString(),o=t.split(",",2);return s[0]=o[0].replace("(",""),s[1]=o[1].replace(")",""),s}function w(s){s="first"==s?":first-child":"."+s,e("#wpsl-meta-nav li"+s+"-tab").hasClass("wpsl-active")||(e("#wpsl-meta-nav li"+s+"-tab").addClass("wpsl-active").siblings().removeClass("wpsl-active"),e(".wpsl-store-meta > div"+s).show().addClass("wpsl-active").siblings("div").hide().removeClass("wpsl-active"))}function u(e){var s={type:"id",val:e.attr("id")};return"undefined"==typeof s.val&&(s={type:"class",val:e.attr("class")}),s}function v(){e("#wpsl-store-hours .wpsl-icon-cancel-circled").off(),e("#wpsl-store-hours .wpsl-icon-cancel-circled").on("click",function(){f(e(this))})}function f(e){var s=h(e),t=e.parents("tr"),o=t.find(".wpsl-opening-hours").attr("data-day");1==s&&t.find(".wpsl-opening-hours").html("<p class='wpsl-store-closed'>"+wpslL10n.closedDate+"<input type='hidden' name='wpsl[hours]["+o+"_open]' value='' /></p>"),e.parent().closest(".wpsl-current-period").remove(),t.find(".wpsl-opening-hours div:first-child").hasClass("wpsl-multiple-periods")&&t.find(".wpsl-opening-hours div:first-child").removeClass("wpsl-multiple-periods")}function h(e){var s=e.parents("tr").find(".wpsl-current-period").length;return s}function m(s){var t,o,r,l,n=!1,i=!1,a="",p="",c=[],d={hours:{hr12:[12,1,2,3,4,5,6,7,8,9,10,11,12,1,2,3,4,5,6,7,8,9,10,11],hr24:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]},interval:["00","15","30","45"]};l=e("#wpsl-editor-hour-format").length?e("#wpsl-editor-hour-format").val():wpslSettings.hourFormat,e("#wpsl-store-hours td").removeAttr("style"),12==l?(e("#wpsl-store-hours").removeClass().addClass("wpsl-twelve-format"),t=d.hours.hr12):(e("#wpsl-store-hours").removeClass().addClass("wpsl-twentyfour-format"),t=d.hours.hr24),o=d.interval;for(var w=0;w<t.length;w++){r=t[w],12==l?(r>=12&&(n=i?!0:!1,i=!0),a=n?"PM":"AM"):24==l&&1==r.toString().length&&(r="0"+r);for(var u=0;u<o.length;u++)c.push(r+":"+o[u]+" "+a)}for(var w=0;w<c.length;w++)p=p+'<option value="'+e.trim(c[w])+'">'+e.trim(c[w])+"</option>";return s?p:void g(p,l)}function g(s,t){var o,r,l,n={};e(".wpsl-current-period").each(function(){l=e(this),n={open:e(this).find(".wpsl-open-hour").val(),close:e(this).find(".wpsl-close-hour").val()},e(this).find("select").html(s).promise().done(function(){for(var s in n)n.hasOwnProperty(s)&&(o=n[s].split(":"),12==t?(r="",0==n[s].charAt(0)?(n[s]=n[s].substr(1),r=" AM"):2==o[0].length&&o[0]>12?(n[s]=o[0]-12+":"+o[1],r=" PM"):o[0]<12?(n[s]=o[0]+":"+o[1],r=" AM"):12==o[0]&&(n[s]=o[0]+":"+o[1],r=" PM"),-1==o[1].indexOf("PM")&&-1==o[1].indexOf("AM")&&(n[s]=n[s]+r)):24==t&&(-1!=o[1].indexOf("PM")?12==o[0]?n[s]="12:"+o[1].replace(" PM",""):n[s]=+o[0]+12+":"+o[1].replace(" PM",""):-1!=o[1].indexOf("AM")?1==o[0].toString().length?n[s]="0"+o[0]+":"+o[1].replace(" AM",""):n[s]=o[0]+":"+o[1].replace(" AM",""):n[s]=o[0]+":"+o[1]),l.find(".wpsl-"+s+"-hour option[value='"+e.trim(n[s])+"']").attr("selected","selected"))})})}function y(){var s="",t=e.trim(e("#wpsl-map-style").val());e(".wpsl-style-preview-error").remove(),t&&(s=b(t),s||e("#wpsl-style-preview").after("<div class='wpsl-style-preview-error'>"+wpslL10n.styleError+"</div>")),L.setOptions({styles:s})}function b(e){try{var s=JSON.parse(e);if(s&&"object"==typeof s&&null!==s)return s}catch(t){}return!1}function C(){var s,t="",o=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,r=e("#wpsl-start-name");"undefined"!=typeof o&&(s=new o(function(s){s.forEach(function(s){"class"===s.attributeName&&(t=e(s.target).prop(s.attributeName),-1!==t.indexOf("gm-err-autocomplete")&&k(wpslL10n.browserKeyError,"browser-key"))})}),s.observe(r[0],{attributes:!0}))}function M(){var s={action:"validate_server_key",server_key:e("#wpsl-api-server-key").val()};e.get(wpslSettings.ajaxurl,s,function(s){s.valid||"undefined"==typeof s.msg?e("#wpsl-api-server-key").removeClass("wpsl-error"):k(s.msg,"server-key")})}function k(s,t){var o,r;o='<div id="setting-error-'+t+'" class="error settings-error notice is-dismissible">',o+="<p><strong>"+s+"</strong></p>",o+='<button type="button" class="notice-dismiss"><span class="screen-reader-text">'+wpslL10n.dismissNotice+"</span></button>",o+="</div>",r=e("#wpsl-tabs").length?"wpsl-tabs":"wpsl-settings-form",e("#"+r).before(o),e("#wpsl-api-"+t).addClass("wpsl-error")}var L,O,P=[];e("#wpsl-gmap-wrap").length&&s(),e("#wpsl-map-settings").length&&(C(),e("#wpsl-api-server-key").hasClass("wpsl-validate-me")&&!e("#setting-error-server-key").length&&M()),e("#wpsl-start-name").length&&o(),e("#wpsl-lookup-location").on("click",function(e){e.preventDefault(),n()}),e(".wpsl-marker-list input[type=radio]").click(function(){e(this).parents(".wpsl-marker-list").find("li").removeClass(),e(this).parent("li").addClass("wpsl-active-marker")}),e(".wpsl-marker-list li").click(function(){e(this).parents(".wpsl-marker-list").find("input").prop("checked",!1),e(this).find("input").prop("checked",!0),e(this).siblings().removeClass(),e(this).addClass("wpsl-active-marker")}),e(".wpsl-dismiss").click(function(){var s=e(this),t={action:"disable_location_warning",_ajax_nonce:s.attr("data-nonce")};return e.post(ajaxurl,t),e(".wpsl-dismiss").parents(".error").remove(),!1}),e(".wpsl-has-conditional-option").on("change",function(){e(this).parent().next(".wpsl-conditional-option").toggle()}),e("#wpsl-store-template").on("change",function(){var s=e("#wpsl-listing-below-no-scroll");"below_map"==e(this).val()?s.show():s.hide()}),e("#wpsl-api-region").on("change",function(){var s=e("#wpsl-geocode-component");e(this).val()?s.show():s.hide()}),e("#wpsl-editor-hour-input").on("change",function(){e(".wpsl-"+e(this).val()+"-hours").show().siblings("div").hide(),e(".wpsl-hour-notice").toggle()}),e("#wpsl-meta-nav li").on("click",function(s){var t=e(this).attr("class");t=t.split("-tab"),s.stopPropagation(),e(this).addClass("wpsl-active").siblings().removeClass("wpsl-active"),e(".wpsl-store-meta ."+t[0]).show().addClass("wpsl-active").siblings("div").hide().removeClass("wpsl-active")}),e("#wpsl-store-details").length&&e("#publish").click(function(){var s,t,o,r='<div id="message" class="error"><p>'+wpslL10n.requiredFields+"</p></div>",l=!1;return e("#wpbody-content .wrap #message").remove(),e(".wpsl-required").removeClass("wpsl-error"),e(".wpsl-required").each(function(){""==e(this).val()&&(e(this).addClass("wpsl-error"),"undefined"==typeof s&&(s=u(e(this))),l=!0)}),l?(e("#wpbody-content .wrap > h2").after(r),"undefined"!=typeof s.val&&("id"==s.type?(t=e("#"+s.val).parents(".wpsl-tab").attr("class"),e("html, body").scrollTop(Math.round(e("#"+s.val).offset().top-100))):"class"==s.type&&(o=s.val.replace(/wpsl-required|wpsl-error/g,""),t=e("."+o).parents(".wpsl-tab").attr("class"),e("html, body").scrollTop(Math.round(e("."+o).offset().top-100))),t=e.trim(t.replace(/wpsl-tab|wpsl-active/g,""))),w(t?t:"first"),e("#publish").removeClass("button-primary-disabled"),e(".spinner").hide(),!1):!0}),e("#wpsl-store-hours").length&&v(),e(".wpsl-add-period").on("click",function(s){var t,o={},r=!0,l=e(this).parents("tr"),n=h(e(this)),i=n>=1?"wpsl-current-period wpsl-multiple-periods":"wpsl-current-period",a=l.find(".wpsl-opening-hours").attr("data-day"),p=e("#wpsl-settings-form").length?"wpsl_editor[dropdown]":"wpsl[hours]";t='<div class="'+i+'">',t+='<select autocomplete="off" name="'+p+"["+a+'_open][]" class="wpsl-open-hour">'+m(r)+"</select>",t+="<span> - </span>",t+='<select autocomplete="off" name="'+p+"["+a+'_close][]" class="wpsl-close-hour">'+m(r)+"</select>",t+='<div class="wpsl-icon-cancel-circled"></div>',t+="</div>",l.find(".wpsl-store-closed").remove(),e("#wpsl-hours-"+a).append(t).end(),v(),o=24==e("#wpsl-editor-hour-format").val()?{open:"09:00",close:"17:00"}:{open:"9:00 AM",close:"5:00 PM"},l.find(".wpsl-open-hour:last option[value='"+o.open+"']").attr("selected","selected"),l.find(".wpsl-close-hour:last option[value='"+o.close+"']").attr("selected","selected"),s.preventDefault()}),e("#wpsl-editor-hour-format, #wpsl-editor-hour-interval").on("change",function(){m()}),e(".wpsl-info").on("mouseover",function(){e(this).find(".wpsl-info-text").show()}),e(".wpsl-info").on("mouseout",function(){e(this).find(".wpsl-info-text").hide()}),e("#wpsl-latlng").length&&!e("#wpsl-latlng").val()&&e("#wpsl-latlng").siblings("label").find(".wpsl-info").addClass("wpsl-required-setting"),e("#wpsl-map-style").val()&&y(),e("#wpsl-style-preview").on("click",function(){return y(),!1}),e("#wpsl-wrap").on("click","button.notice-dismiss",function(){e(this).closest("div.notice").remove()})});